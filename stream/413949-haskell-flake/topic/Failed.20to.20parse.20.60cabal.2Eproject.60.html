<html>
<head><meta charset="utf-8"><title>Failed to parse `cabal.project` · haskell-flake · Zulip Chat Archive</title></head>
<h2>Stream: <a href="http://chat.nixos.asia/stream/413949-haskell-flake/index.html">haskell-flake</a></h2>
<h3>Topic: <a href="http://chat.nixos.asia/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60.html">Failed to parse `cabal.project`</a></h3>

<hr>

<base href="https://nixos.zulipchat.com">

<head><link href="http://chat.nixos.asia/style.css" rel="stylesheet"></head>

<a name="422383676"></a>
<h4><a href="https://nixos.zulipchat.com#narrow/stream/413949-haskell-flake/topic/Failed%20to%20parse%20%60cabal.project%60/near/422383676" class="zl"><img src="http://chat.nixos.asia/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Neeraj <a href="http://chat.nixos.asia/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60.html#422383676">(Feb 20 2024 at 10:03)</a>:</h4>
<p>Failed to parse /nix/store/hk9ikz0hwh3swvqmcwmgcr5dxw1f736p-source/cabal.project: {"type":"error","value":{"context":"parsec.string","msg":"expected string 'packages:'","offset":0,"str":"-- Generated by stackage-to-hackage<br>
with-compiler: ghc-8.10.7 .......<br>
Sample cabal.project</p>
<div class="codehilite"><pre><span></span><code>-- Generated by stackage-to-hackage

with-compiler: ghc-8.10.7

packages:
    ./

source-repository-package
    type: git
    location: https://github.com/aravindgopall/hsaml2.git
    tag: d4ecf51a0bf3733eb1ff8724a691b0200b3355ee

allow-older: *
allow-newer: *
</code></pre></div>



<a name="422402321"></a>
<h4><a href="https://nixos.zulipchat.com#narrow/stream/413949-haskell-flake/topic/Failed%20to%20parse%20%60cabal.project%60/near/422402321" class="zl"><img src="http://chat.nixos.asia/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Srid <a href="http://chat.nixos.asia/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60.html#422402321">(Feb 20 2024 at 12:00)</a>:</h4>
<p><span class="user-mention" data-user-id="691894">@Neeraj</span> The cabal.project parser is pretty <a href="https://github.com/srid/haskell-flake/tree/master/nix/haskell-parsers#limitations">limited</a>.</p>
<p>Move <code>packages:</code> to the first line, and see if that works.</p>



<a name="422402358"></a>
<h4><a href="https://nixos.zulipchat.com#narrow/stream/413949-haskell-flake/topic/Failed%20to%20parse%20%60cabal.project%60/near/422402358" class="zl"><img src="http://chat.nixos.asia/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Srid <a href="http://chat.nixos.asia/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60.html#422402358">(Feb 20 2024 at 12:01)</a>:</h4>
<p>And it will only recognizes <code>packages</code>, not others. You have to specify them in Nix.</p>



<a name="422402745"></a>
<h4><a href="https://nixos.zulipchat.com#narrow/stream/413949-haskell-flake/topic/Failed%20to%20parse%20%60cabal.project%60/near/422402745" class="zl"><img src="http://chat.nixos.asia/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Srid <a href="http://chat.nixos.asia/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60.html#422402745">(Feb 20 2024 at 12:03)</a>:</h4>
<p>The first two lines should look like:</p>
<div class="codehilite"><pre><span></span><code>❯ head -n 2 cabal.project
packages:
    ./
</code></pre></div>



<a name="422402890"></a>
<h4><a href="https://nixos.zulipchat.com#narrow/stream/413949-haskell-flake/topic/Failed%20to%20parse%20%60cabal.project%60/near/422402890" class="zl"><img src="http://chat.nixos.asia/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Srid <a href="http://chat.nixos.asia/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60.html#422402890">(Feb 20 2024 at 12:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="667408">Srid</span> <a href="#narrow/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60/near/422402358">said</a>:</p>
<blockquote>
<p>And it will only recognizes <code>packages</code>, not others. You have to specify them in Nix.</p>
</blockquote>
<p>For eg., <code>source-repository-package</code> should be specified as flake inputs and used as a dependency override. See <a href="https://community.flake.parts/haskell-flake/dependency#path">https://community.flake.parts/haskell-flake/dependency#path</a></p>



<a name="422608668"></a>
<h4><a href="https://nixos.zulipchat.com#narrow/stream/413949-haskell-flake/topic/Failed%20to%20parse%20%60cabal.project%60/near/422608668" class="zl"><img src="http://chat.nixos.asia/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Srid <a href="http://chat.nixos.asia/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60.html#422608668">(Feb 21 2024 at 12:44)</a>:</h4>
<p>(Oops, I realized I linked to haskell-flake docs but of course you'd use the same <code>callCabal2nix</code> function to specify these source-repository-package using flake inputs)</p>



<a name="422768326"></a>
<h4><a href="https://nixos.zulipchat.com#narrow/stream/413949-haskell-flake/topic/Failed%20to%20parse%20%60cabal.project%60/near/422768326" class="zl"><img src="http://chat.nixos.asia/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Neeraj <a href="http://chat.nixos.asia/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60.html#422768326">(Feb 22 2024 at 08:26)</a>:</h4>
<p>How to exclude <code>cabal.project</code>  so that nix will not parse it?</p>



<a name="422771217"></a>
<h4><a href="https://nixos.zulipchat.com#narrow/stream/413949-haskell-flake/topic/Failed%20to%20parse%20%60cabal.project%60/near/422771217" class="zl"><img src="http://chat.nixos.asia/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Neeraj <a href="http://chat.nixos.asia/stream/413949-haskell-flake/topic/Failed.20to.20parse.20.60cabal.2Eproject.60.html#422771217">(Feb 22 2024 at 08:46)</a>:</h4>
<p>got it. Using <a href="https://github.com/numtide/nix-filter">nix-filter</a> solved it</p>



<hr><p>Last updated: Nov 01 2025 at 22:16 UTC</p>
</html>