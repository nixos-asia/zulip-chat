[
    {
        "content": "<p>Hi, first off, thanks for creating <code>haskell-flake</code>! It got me up and running with Haskell quickly.</p>\n<p>I'm trying to deploy a Haskell project to a NixOS server and compilation fails when trying to embed files using template Haskell:</p>\n<div class=\"codehilite\"><pre><span></span><code>src/Settings.hs:139:23: error: [GHC-87897]\n    • Exception when trying to run compile-time code:\n        config/settings.yml: withBinaryFile: does not exist (No such file or directory)\n      Code: (embedFile configSettingsYml)\n    • In the untyped splice: $(embedFile configSettingsYml)\n    |\n139 | configSettingsYmlBS = $(embedFile configSettingsYml)\n    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n[12 of 54] Compiling TodoBundleName   ( src/TodoBundleName.hs, dist/build/TodoBundleName.o, dist/build/TodoBundleName.dyn_o )\n[13 of 54] Compiling TodoName         ( src/TodoName.hs, dist/build/TodoName.o, dist/build/TodoName.dyn_o )\n[14 of 54] Compiling TodoStatus       ( src/TodoStatus.hs, dist/build/TodoStatus.o, dist/build/TodoStatus.dyn_o )\n[15 of 54] Compiling TransferFeePaidBy ( src/TransferFeePaidBy.hs, dist/build/TransferFeePaidBy.o, dist/build/TransferFeePaidBy.dyn_o )\n[16 of 54] Compiling Model            ( src/Model.hs, dist/build/Model.o, dist/build/Model.dyn_o )\n\nsrc/Model.hs:64:3: error: [GHC-87897]\n    • Exception when trying to run compile-time code:\n        config/models.persistentmodels: withBinaryFile: does not exist (No such file or directory)\n      Code: (persistFileWith\n               lowerCaseSettings &quot;config/models.persistentmodels&quot;)\n    • In the untyped splice:\n        $(persistFileWith\n            lowerCaseSettings &quot;config/models.persistentmodels&quot;)\n   |\n64 |   $(persistFileWith lowerCaseSettings &quot;config/models.persistentmodels&quot;)\n   |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre></div>\n<p>The project compiles on my NixOS development machine using the devShell but the error occurs when deploying to a server running NixOS.</p>\n<p>The files exist in the project, are checked in to the repo, and our old deployment pipeline using Docker works so I think I've made some mistake when setting it up using <code>haskell-flake</code>.</p>\n<p>Do I have to whitelist these files to be part of the build or so? I tried reading up on it but am too new to Nix to understand.</p>\n<p>Here's the <code>flake.nix</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  inputs = {\n    nixpkgs.url = &quot;github:nixos/nixpkgs/f373ad52f1fa4187abeb7d1ce1056314bcbc9980&quot;;\n    flake-parts.url = &quot;github:hercules-ci/flake-parts&quot;;\n    haskell-flake.url = &quot;github:srid/haskell-flake&quot;;\n  };\n  outputs = inputs@{ self, nixpkgs, flake-parts, ... }:\n    flake-parts.lib.mkFlake { inherit inputs; } {\n      systems = nixpkgs.lib.systems.flakeExposed;\n      imports = [ inputs.haskell-flake.flakeModule ];\n      perSystem = { self&#39;, system, lib, config, pkgs, ... }: {\n        haskellProjects.default = {\n          basePackages = pkgs.haskell.packages.ghc982;\n\n          # Want to override dependencies?\n          # See https://haskell.flake.page/dependency\n          settings = {\n            slugify.check = false;\n            sendgrid-v3.check = false;\n            fast-logger.check = false;\n          };\n\n          devShell = {\n            hlsCheck.enable = false;\n          };\n\n          autoWire = [ &quot;packages&quot; &quot;apps&quot; &quot;checks&quot; ]; # Wire all but the devShell\n        };\n\n        packages.default = self&#39;.packages.internal-hs;\n        # apps.default = self&#39;.apps.internal-hs;\n\n        devShells.default = pkgs.mkShell {\n          name = &quot;Haskell devShell&quot;;\n          inputsFrom = [\n            config.haskellProjects.default.outputs.devShell\n          ];\n          nativeBuildInputs = with pkgs; [\n            watchexec\n            pcre\n            zlib\n          ];\n        };\n      };\n    };\n}\n</code></pre></div>",
        "id": 432279676,
        "sender_full_name": "Jkru",
        "timestamp": 1712678355
    },
    {
        "content": "<p>Welcome, <span class=\"user-mention\" data-user-id=\"708802\">@Jkru</span> </p>\n<p>Did you include <code>config/models.persistentmodels</code> in Cabal's <code>data-files</code>?</p>",
        "id": 432348509,
        "sender_full_name": "Srid",
        "timestamp": 1712699649
    },
    {
        "content": "<p>Thank you, that solved the issue!</p>",
        "id": 433058151,
        "sender_full_name": "Jkru",
        "timestamp": 1713024354
    }
]