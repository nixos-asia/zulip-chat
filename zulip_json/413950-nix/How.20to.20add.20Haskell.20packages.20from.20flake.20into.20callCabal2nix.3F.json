[
    {
        "content": "<ul>\n<li>Hello, I'm trying to develop a haskell project named <code>my-project</code>, and it is relying on a haskell package named <code>some-package</code> from a nix flake named <code>some-flake</code>, but I don't know how to make cabal find it correctly, here is my flake:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Nix\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"ss\">inputs</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    some-flake<span class=\"o\">.</span><span class=\"ss\">url</span> <span class=\"o\">=</span> <span class=\"s2\">\"github:...\"</span><span class=\"p\">;</span>\n  <span class=\"p\">};</span>\n\n  <span class=\"ss\">outputs</span> <span class=\"o\">=</span> <span class=\"p\">{</span> nixpkgs<span class=\"p\">,</span> some-flake<span class=\"p\">,</span> <span class=\"o\">...</span> <span class=\"p\">}:</span>\n  <span class=\"k\">let</span>\n    <span class=\"ss\">project_name</span> <span class=\"o\">=</span> <span class=\"s2\">\"my-project\"</span><span class=\"p\">;</span>\n    <span class=\"ss\">supportedSystems</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"s2\">\"x86_64-linux\"</span> <span class=\"s2\">\"aarch64-linux\"</span> <span class=\"s2\">\"x86_64-darwin\"</span> <span class=\"s2\">\"aarch64-darwin\"</span> <span class=\"p\">];</span>\n    <span class=\"ss\">eachSystem</span> <span class=\"o\">=</span> f<span class=\"p\">:</span> nixpkgs<span class=\"o\">.</span>lib<span class=\"o\">.</span>genAttrs supportedSystems <span class=\"p\">(</span>system<span class=\"p\">:</span> f <span class=\"k\">rec</span> <span class=\"p\">{</span>\n      <span class=\"k\">inherit</span> system<span class=\"p\">;</span>\n      <span class=\"ss\">pkgs</span> <span class=\"o\">=</span> nixpkgs<span class=\"o\">.</span>legacyPackages<span class=\"o\">.</span><span class=\"si\">${</span>system<span class=\"si\">}</span><span class=\"p\">;</span>\n      <span class=\"ss\">hpkgs</span> <span class=\"o\">=</span> pkgs<span class=\"o\">.</span>haskell<span class=\"o\">.</span>packages<span class=\"o\">.</span>ghc98<span class=\"p\">;</span>\n    <span class=\"p\">});</span>\n  <span class=\"k\">in</span>\n  <span class=\"k\">rec</span> <span class=\"p\">{</span>\n    <span class=\"ss\">packages</span> <span class=\"o\">=</span> eachSystem <span class=\"p\">({</span>hpkgs<span class=\"p\">,</span> system<span class=\"p\">,</span> <span class=\"o\">...</span><span class=\"p\">}:</span> <span class=\"p\">{</span>\n      <span class=\"ss\">default</span> <span class=\"o\">=</span> hpkgs<span class=\"o\">.</span>callCabal2nix project_name <span class=\"l\">./.</span> <span class=\"p\">{</span>\n        <span class=\"ss\">some-package</span> <span class=\"o\">=</span> some-flake<span class=\"o\">.</span>packages<span class=\"o\">.</span><span class=\"si\">${</span>system<span class=\"si\">}</span><span class=\"o\">.</span>default<span class=\"p\">;</span> <span class=\"c1\">#this seems not working</span>\n      <span class=\"p\">};</span>\n    <span class=\"p\">});</span>\n\n    <span class=\"ss\">devShells</span> <span class=\"o\">=</span> eachSystem <span class=\"p\">({</span>pkgs<span class=\"p\">,</span> hpkgs<span class=\"p\">,</span> system<span class=\"p\">,</span> <span class=\"o\">...</span><span class=\"p\">}:</span> <span class=\"p\">{</span>\n      <span class=\"ss\">default</span> <span class=\"o\">=</span> pkgs<span class=\"o\">.</span>haskell<span class=\"o\">.</span>lib<span class=\"o\">.</span>addBuildTools packages<span class=\"o\">.</span><span class=\"si\">${</span>system<span class=\"si\">}</span><span class=\"o\">.</span>default\n        <span class=\"p\">(</span><span class=\"k\">with</span> hpkgs<span class=\"p\">;</span> <span class=\"p\">[</span> haskell-language-server cabal-install <span class=\"p\">]);</span>\n    <span class=\"p\">});</span>\n  <span class=\"p\">};</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Any help?</p>",
        "id": 472918117,
        "sender_full_name": "LC",
        "timestamp": 1727363021
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"761060\">@LC</span> You want to use the haskell package overlay:</p>\n<p><a href=\"https://nixos.asia/en/nixify-haskell-nixpkgs\">https://nixos.asia/en/nixify-haskell-nixpkgs</a></p>",
        "id": 473840975,
        "sender_full_name": "Srid",
        "timestamp": 1727726280
    },
    {
        "content": "<p>which is simpler when using <code>haskell-flake</code>: <a href=\"https://community.flake.parts/haskell-flake/dependency#path\">https://community.flake.parts/haskell-flake/dependency#path</a></p>",
        "id": 473841163,
        "sender_full_name": "Srid",
        "timestamp": 1727726306
    }
]